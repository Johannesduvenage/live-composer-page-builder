sudo: false
language: php
notifications:
  email:
    on_success: never
    on_failure: change
cache:
  directories:
  - vendor
  - "$HOME/.composer/cache"
matrix:
  include:
  - php: 7.1
    env: WP_VERSION=latest WP_MULTISITE=1
  - php: 5.3
    env: WP_VERSION=latest
    dist: precise

before_script:
- export PATH="$HOME/.composer/vendor/bin:$PATH"
- |
  if [ -f ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/xdebug.ini ]; then
    phpenv config-rm xdebug.ini
  else
    echo "xdebug.ini does not exist"
  fi
- |
  if [[ ! -z "$WP_VERSION" ]] ; then
    bash bin/install-wp-tests.sh wordpress_test root '' localhost $WP_VERSION
    if [[ ${TRAVIS_PHP_VERSION:0:2} == "5." ]]; then
      composer global require "phpunit/phpunit=4.8.*"
    else
      composer global require "phpunit/phpunit=5.7.*"
    fi
  fi
- |
  if [[ "$WP_TRAVISCI" == "phpcs" ]] ; then
    composer global require wp-coding-standards/wpcs
    phpcs --config-set installed_paths $HOME/.composer/vendor/wp-coding-standards/wpcs
  fi

script:
- |
  if [[ ! -z "$WP_VERSION" ]] ; then
    phpunit
    WP_MULTISITE=1 phpunit
  fi
- |
  if [[ "$WP_TRAVISCI" == "phpcs" ]] ; then
    phpcs
  fi
- whereis google-chrome-stable
- whereis chromedriver

addons:
  sauce_connect: # Connecto to Sauce Labs
    username: livecomposer
    access_key: 
      secure: "uNd18W5u4nfySwEjXXby24lA34II4d7Q+YTm5q9bnZDnQFsI7OkVScu8V4D8XLlNKZtG5pmqcXaputN0gJJCNKNATvlnXfw4reHFHHbBL1Ko0PiRxiALLIArJaMT1QNMEo/bc1Ok8l2AjoovibEco3zLGmkr5E/1dMHTdyAax0s5bhAbCjhiK++dIwpdbI7z6Pal0DBZ7FqmALrj61So+Iwa6l8ZL+U/Wx9uuIBZB+uZS1GJ061Dp2R+iMfWkpinLJhCr3NsQuIbFEBlgA0eLG/tXjJ9ATsd9hToPtSoxa1a0kbjE1wGApGfdNaFa5bXTe/k9nGmMcZPSEFCTrXXP84pjQ8q+wiz0yI76aDukgxzu5qL41VrqNcbCOYXx9xqtbyoqyrXCKNp6qZD717uQ8AlmbrOWjIxRfO7i2qHYRnHKCKk7sEr9ZcTEZSQFfCBLYmO3hhTqPXWYCPhnXUoAf+exnXL5FKHzHV2IsNOdkTWGYeF3+vQ3xAWQfIvhQvZsVOJy49DXRQ5nyRxWs7K71ggMsbCliZfBpy92gdfYCZrCK/LNqFMW+H+yZvCjELRUxwlLYawGUnjgQwjcD5cXY3Deh0Qu1NPzvZ5WRp872DyiSO5Dx+9ewqhgJAWQC1tbf0eRpqpiNJoQAu12HIoZwrFVLv7wUg6Na9Bhgoam3k="
  chrome: stable # get google-chrome-stable

install: # Install ChromeDriver (64bits; replace 64 with 32 for 32bits).
  - wget -N http://chromedriver.storage.googleapis.com/2.30/chromedriver_linux64.zip -P ~/
  - unzip ~/chromedriver_linux64.zip -d ~/
  - rm ~/chromedriver_linux64.zip
  - sudo mv -f ~/chromedriver /usr/local/share/
  - sudo chmod +x /usr/local/share/chromedriver
  - sudo ln -s /usr/local/share/chromedriver /usr/local/bin/chromedriver